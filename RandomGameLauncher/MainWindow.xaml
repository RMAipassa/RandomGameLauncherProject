<Window x:Class="RandomGameLauncher.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Random Game Launcher"
        Width="980" Height="650"
        WindowStartupLocation="CenterScreen"
        Icon="pack://siteoforigin:,,,/Assets/dice.ico">
    <Window.InputBindings>
        <KeyBinding Key="R" Modifiers="Control" Command="{Binding LaunchRandomCommand}" />
        <KeyBinding Key="F" Modifiers="Control" Command="{Binding FocusSearchCommand}" />
    </Window.InputBindings>

    <Grid x:Name="RootGrid" Margin="12">
        <Border Background="{DynamicResource App.WindowBackgroundBrush}"
                BorderBrush="{DynamicResource App.BorderBrush}"
                BorderThickness="1"
                CornerRadius="{StaticResource App.CornerRadius.L}"
                Padding="12">
            <DockPanel>
                <DockPanel DockPanel.Dock="Top" LastChildFill="True">
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Theme" Margin="0,0,8,0" VerticalAlignment="Center" Foreground="{DynamicResource App.SubtleTextBrush}" />
                        <ComboBox x:Name="ThemeCombo" Width="110" SelectedItem="{Binding Theme}" />
                        <TextBlock Text="Backdrop" Margin="14,0,8,0" VerticalAlignment="Center" Foreground="{DynamicResource App.SubtleTextBrush}" />
                        <ComboBox x:Name="BackdropCombo" Width="110" SelectedItem="{Binding Backdrop}" />
                    </StackPanel>

                    <WrapPanel VerticalAlignment="Center">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox x:Name="SearchBox" Width="260" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock Text="Tags:" VerticalAlignment="Center" Margin="12,0,8,0" Foreground="{DynamicResource App.SubtleTextBrush}" />
                        <Button Content="Choose..." Padding="10,6" Click="ChooseTagFilter_Click" />
                        <Button Content="Clear" Margin="8,0,0,0" Padding="10,6" Click="ClearTagFilter_Click" IsEnabled="{Binding HasTagFilter}" />
                        <TextBlock Text="{Binding SelectedTagFilterText}" Margin="10,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource App.SubtleTextBrush}" />
                        <CheckBox Content="All" Margin="8,0,0,0" VerticalAlignment="Center" IsChecked="{Binding TagFilterMatchAll}" />

                        <CheckBox Content="Steam" Margin="16,0,0,0" VerticalAlignment="Center" IsChecked="{Binding IncludeSteam}" />
                        <CheckBox Content="Epic" Margin="10,0,0,0" VerticalAlignment="Center" IsChecked="{Binding IncludeEpic}" />

                        <Separator Margin="14,0,14,0" Width="1" />

                        <ToggleButton Content="Favorites Only" IsChecked="{Binding FavoritesOnly}" />

                        <CheckBox Content="Weight by playtime" Margin="14,0,0,0" VerticalAlignment="Center" IsChecked="{Binding UsePlaytimeWeighting}" />

                        <Button Content="Refresh" Margin="14,0,0,0" Padding="14,6" Command="{Binding RefreshCommand}" />
                        <Button Content="Fetch Playtime" Margin="10,0,0,0" Padding="14,6" Command="{Binding FetchPlaytimeCommand}" />
                        <Button Content="Import Steam tags" Margin="10,0,0,0" Padding="14,6" Click="ImportSteamTags_Click" IsEnabled="{Binding CanImportSteamTags}" />

                        <StackPanel Orientation="Horizontal" Margin="14,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="SteamID64" VerticalAlignment="Center" Margin="0,0,6,0" Foreground="{DynamicResource App.SubtleTextBrush}"/>
                            <TextBox Width="140" Text="{Binding SteamId64}" />
                            <Button Content="Detect" Margin="8,0,0,0" Padding="10,6" Click="DetectSteamId_Click" />
                            <TextBlock Text="API key" VerticalAlignment="Center" Margin="10,0,6,0" Foreground="{DynamicResource App.SubtleTextBrush}"/>
                            <PasswordBox Width="150" x:Name="ApiKeyBox"/>
                            <Button Content="Save" Margin="10,0,0,0" Padding="10,6" Click="SaveApiKey_Click"/>
                            <Button Content="Get API key" Margin="8,0,0,0" Padding="10,6" Click="GetApiKey_Click" />
                        </StackPanel>

                        <Button Content="Launch Random (Ctrl+R)" Margin="14,0,0,0" Padding="14,6" Command="{Binding LaunchRandomCommand}"/>
                    </WrapPanel>
                </DockPanel>

                <DataGrid Margin="0,12,0,0"
                          x:Name="GamesGrid"
                          ItemsSource="{Binding ViewAll}"
                          AutoGenerateColumns="False"
                          CanUserSortColumns="True"
                          IsReadOnly="False"
                          PreviewMouseRightButtonDown="GamesGrid_PreviewMouseRightButtonDown">
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Edit tags..." Click="EditTags_Click" />
                            <MenuItem Header="Clear tags" Click="ClearTags_Click" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="Include" Binding="{Binding Included, Mode=TwoWay}" Width="80"/>
                        <DataGridCheckBoxColumn Header="â˜…" Binding="{Binding Favorite, Mode=TwoWay}" Width="50"/>
                        <DataGridTextColumn Header="Game" Binding="{Binding Name}" Width="*"/>
                        <DataGridTextColumn Header="Platform" Binding="{Binding Platform}" Width="90"/>
                        <DataGridTextColumn Header="Playtime (hrs)" Binding="{Binding DisplayPlaytimeHours}" Width="120"/>
                        <DataGridTextColumn Header="Install Location" Binding="{Binding InstallPath}" Width="340"/>
                        <DataGridTextColumn Header="Tags" Binding="{Binding AllTagsText}" Width="220"/>
                    </DataGrid.Columns>
                </DataGrid>

                <StatusBar DockPanel.Dock="Bottom" Margin="0,12,0,0">
                    <StatusBarItem Content="{Binding StatusText}" />
                    <StatusBarItem HorizontalAlignment="Right">
                        <CheckBox Content="Start minimized to tray" IsChecked="{Binding StartMinimizedToTray}" />
                    </StatusBarItem>
                    <StatusBarItem HorizontalAlignment="Right">
                        <CheckBox Content="Minimize to tray" IsChecked="{Binding MinimizeToTray}" />
                    </StatusBarItem>
                </StatusBar>
            </DockPanel>
        </Border>

        <Image x:Name="ThemeTransitionOverlay"
               Visibility="Collapsed"
               IsHitTestVisible="False"
               Stretch="Fill" />
    </Grid>
</Window>
